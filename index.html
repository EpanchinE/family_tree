<!DOCTYPE html>
<html>
  <head>
    <title>BASE FAMILY TREE WEB APPLICATION</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAEkYuABNKMQAfk2gAITwrABlJLgAVeVEA2fPoABp8UQAaelQA+P38ABRdPQAno2sA/v7/AP/+/wAVjWAAIoVaACWGXQA2oW4AH41gAB+RYwARSS8AF3NJABhzSQAWd0wAE1E1AGKrggAtZEkAF39SABAwGwAhd0wAFVs4ABxTOwAdg1UAK3NSAC6ebwBBiWYAKadvAFGngAAlhl4AEHNKAEO8iQARSTAAEkkwABdJMAAZRzMAKY5kACqOZAAhbUoAMVpHABJUNgDh7+cAHKd5ADKVZwAbhFkA5vTtADVxVgAjilkAMUs/AEKScAAac0sAGXROABlHNAAgc0sA9/v5APr++QAdTT0AF1s6ABaHWgAqTDoANpVxAB+PYAAVQykAGz8mACOIZgAVcEwAsO/YAChhQwAmYkYAI5dmABRQNQA4iF0ADjMeACFKNQAJjmcADjchABpYOwAqn2wAEGU+AD2JaQAUPCcAH4pbABdqRABYo4AAY5Z9ACmJYQAXRy0AGEswABdNNgAml2cAFlU8ABdXOQAgpnAAIXtTABBlPwDO49kAEGg/AB2DWQAaiVkAGVpCABtcPwAkqXkAGWBCAB5cPwAiWDwAFZZlABJDKwBLq5AA1OvfABduSABil4EAEUouACuDYgAUeEsAOKl5AB9vSwD1/fkAM4dlABCIYAD9/vwAI3pRAP///wAeglcAFy8mAByHXQASa0AAFmNDABqOYABFi2gAMKlxABlqRgAvr3oAHHJMAB5zTwAfSDIAG3pSABl+VQASXTsAF1c7AB2AUgAcg1sAHIlbAC0kDwAVOCcAFz0kACFfQQC+3coAG2pHABhwRwAlEQQAFU0wAA0qGQALMRwAGnxQAPj9+wAcUDkACzwiAP3+/gDM6NAA/v7+AA5rQgAlUDkA5/fzABJBKAAXZkUANZ9wACCMXACJmYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIODg4ODg4OYg4ODg4ODg4ODg6mBfqepn6RpNwqDg4ODqXReU5A4EUsiZ2VxGwVMg3grbj4EOjEclg8hL6piVDN2Mh1tRZmiQoWIE5Iph291hosnAXkCUK2aFUctlz1YgH8IC2tVEGiJZmOdkWByrnpdhHCeaqUuSKE/r09fQ5M7QDCmd0QgFFeVKKtkjY59JKk0ik5hIxlalCo5CTw2EqyDB4xJo1KgUXtcj7AGViaDg4OoFx4fGCxNsZsWNQOpg4ODg4NGggwlbFtzfEGDg4ODg4ODDakaSlmcqQ6Dg4ODAAAAAAAAAAAAAAAAAAAAAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AAA=" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="assets/css/style.css" />
	<!-- OSX Style CSS files -->
	<link type='text/css' href='assets/css/osx.css' rel='stylesheet' media='screen' />
    <script type="text/javascript" src="/js/libs/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/js/libs/json2.js"></script>
    <script type="text/javascript" src="/js/libs/underscore-min.js"></script>
    <script type="text/javascript" src="/js/libs/backbone-min.js"></script>
 
    <script type="text/javascript" src="/js/app/controllers/BaseController.js"></script>
    <script type="text/javascript" src="/js/app/models/BaseModel.js"></script>
    <script type="text/javascript" src="/js/app/views/BaseView.js"></script>
	
    <script type="text/javascript" src="/js/app/router.js"></script>	
  </head>
  <body>
    
    <div id="home">
      
    </div>
	<script src="/js/libs/Three.js"></script>
<script src="/js/libs/js/Stats.js"></script>
<script src="/js/libs/js/helvetiker_regular.typeface.js"></script>
<script src='/js/libs/threex.domevent.js'></script>
<script src='/js/libs/threex.domevent.object3d.js'></script>


<script>
			var container, stats;

			var camera, scene, projector, renderer;

			var cube, plane, c, cube2;
			var objects = []; // array of NODES

			var targetRotation = 0;
			var targetRotationOnMouseDown = 0;

			var mouseX = 0;
			var mouseXOnMouseDown = 0;
			var mouseY = 0;
			var mouseYOnMouseDown = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var mouse = new THREE.Vector2();
			var mouseHover = false;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				var info = document.createElement( 'div' );

				container.appendChild( info );

				scene = new THREE.Scene();

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.y = 150;
				camera.position.z = 500;
				//camera.position.x = 200;
				scene.add( camera );
				THREE.Object3D._threexDomEvent.camera(camera);
				// Cube

				var materials = [];

				for ( var i = 0; i < 6; i ++ ) {
					materials.push( new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } ) );
				}
				
				c = create_node("Last_Name", "First_Name", "08-08-88", "09-09-99");
				
				
				// Image mesh
				function create_node(l_name, f_name, b_date, d_date) {
				  var cube2 = new THREE.Object3D();
				  var width = 350;
				  var height = 250;
				  function text(l_name, f_name, b_date, d_date){
					var canvas = document.createElement('canvas');
					canvas.width = width;
					canvas.height = height;
					var context = canvas.getContext("2d");
					context.fillStyle = "orange";
					context.font = '24px Arial';
					context.fillText(l_name, 180, 70);
					context.fillText(f_name, 180, 100);
					context.fillText(b_date, 180, 130);
					context.fillText(d_date, 180, 160);
					var tex = new THREE.Texture(canvas);
					tex.needsUpdate = true;
					var mat = new THREE.MeshBasicMaterial({map: tex, overdraw: true});
					mat.transparent = true;
					var item = new THREE.Mesh(  new THREE.PlaneGeometry(canvas.width, canvas.height), mat);
					return item;
				  }
				  function texture(path, size_x, size_y){
					var tex = THREE.ImageUtils.loadTexture(path);
					var mat = new THREE.MeshBasicMaterial({map: tex, overdraw: true});
					mat.transparent = true;
					var item = new THREE.Mesh(  new THREE.PlaneGeometry(size_x, size_y), mat);
					return item;
				  };
				  cube2.add(texture('node.jpg', width, height));
				  var photo = texture('image.jpg', 128, 128);
				  photo.position.x = -100;
				  photo.position.y = 20;
				  cube2.add(photo);
				  cube2.add(text(l_name, f_name));
				  return cube2;
				}
				c.scale.x=c.scale.y=0.7;
				
				
				cube2=c;
				
				objects.push(c);
				
				scene.add(c);
				
				projector = new THREE.Projector();
		
				renderer = new THREE.CanvasRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'mouseup', onDocumentMouseUp, false );
				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );
				document.addEventListener( 'touchmove', onDocumentTouchMove, false );
				
			}

			//

			function onDocumentMouseDown( event ) {

				/*event.preventDefault();

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'mouseup', onDocumentMouseUp, false );
				document.addEventListener( 'mouseout', onDocumentMouseOut, false );

				mouseXOnMouseDown = event.clientX - windowHalfX;
				targetRotationOnMouseDown = targetRotation;*/
				event.preventDefault();

				var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
				projector.unprojectVector( vector, camera );

				var ray = new THREE.Ray( camera.position, vector.subSelf( camera.position ).normalize() );

				var intersects = ray.intersectObjects( objects );

				if ( intersects.length > 0 ) {
					mouseHover = true;
					//SELECTED = intersects[ 0 ].object;
					//var intersects = ray.intersectObject( plane );
					//offset.copy( intersects[ 0 ].point ).subSelf( plane.position );
				}
				else
				{
					mouseHover = false;
				}

			}

			function onDocumentMouseMove( event ) {

				event.preventDefault();
				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
				
				var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
				projector.unprojectVector( vector, camera );
				var ray = new THREE.Ray( camera.position, vector.subSelf( camera.position ).normalize() );
				var intersects = ray.intersectObjects( objects );
				//console.log(intersects.length);
				
				if ( intersects.length > 0 ) 
				{
					container.style.cursor = 'pointer';
					if(mouseHover)
					{
						container.style.cursor = 'move';
						mouseX = event.clientX - windowHalfX;
						mouseY = event.clientY - windowHalfY;
						targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.02;
					}
				}
				else
				{
					container.style.cursor = 'auto';
				}
				//mouseX = event.clientX - windowHalfX;
				//mouseY = event.clientY - windowHalfY;

				//targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.02;
				
				/*mouseX = mouse.x;
				mouseY = mouse.y;
				targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.02;*/
				
			}

			function onDocumentMouseUp( event ) {
				event.preventDefault();
				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
				
				var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
				projector.unprojectVector( vector, camera );
				var ray = new THREE.Ray( camera.position, vector.subSelf( camera.position ).normalize() );
				var intersects = ray.intersectObjects( objects );
				
				if ( intersects.length > 0 ) 
				{
					container.style.cursor = 'pointer';
				}
				else
				{
					container.style.cursor = 'auto';
				}
				mouseHover = false;
				
				/*document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
				document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
				document.removeEventListener( 'mouseout', onDocumentMouseOut, false );*/
			}

			function onDocumentMouseOut( event ) {

				document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
				document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
				document.removeEventListener( 'mouseout', onDocumentMouseOut, false );
			}

			function onDocumentTouchStart( event ) {

				if ( event.touches.length == 1 ) {

					event.preventDefault();

					mouseXOnMouseDown = event.touches[ 0 ].pageX - windowHalfX;
					targetRotationOnMouseDown = targetRotation;

				}
			}

			function onDocumentTouchMove( event ) {

				if ( event.touches.length == 1 ) {

					event.preventDefault();

					mouseX = event.touches[ 0 ].pageX - windowHalfX;
					targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.05;

				}
			}

			//

			function animate() {
				requestAnimationFrame( animate );
				render();
				stats.update();
			}

			function render() {
				//cube.rotation.y += ( targetRotation - cube.rotation.y ) * 0.05;
				cube2.position.x = mouseX;
				cube2.position.y = -mouseY+150;
				renderer.render( scene, camera );
			}
</script>
<div id="osx-modal-content">
			<div id="osx-modal-title">OSX Style Modal Dialog</div>
			<div class="close"><a href="#" class="simplemodal-close">x</a></div>
			<div id="osx-modal-data">
				<h2>Hello! I'm SimpleModal!</h2>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eu dolor lacus. Praesent et metus eleifend erat viverra rutrum. Maecenas rutrum, velit vel placerat dapibus, mi lacus sodales velit, nec iaculis felis magna a velit. Pellentesque vitae luctus turpis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Integer placerat mattis tellus, nec eleifend sapien pulvinar in. Cras sit amet luctus leo. Quisque vitae neque enim. In sit amet nisi nisl, pulvinar tincidunt felis. Vivamus id diam in turpis auctor tristique non quis elit. Ut scelerisque porta justo eget vulputate. Praesent magna odio, dignissim nec blandit sodales, elementum sit amet ipsum.</p>
				<p><button class="simplemodal-close">Close</button> <span>(or press ESC or click the overlay)</span></p>
			</div>
</div>
<script type='text/javascript' src='/js/libs/jquery.simplemodal.js'></script>
<script type='text/javascript' src='/js/libs/osx.js'></script>
<a href="#" id="uLogin" style="position:absolute; bottom:0px"><img src="http://ulogin.ru/img/button.png" width=187 height=30 alt="МультиВход"/></a>
<script src="http://ulogin.ru/js/widget.js?display=window&fields=first_name,last_name,photo&redirect_uri=http%3A%2F%2Fstudia-vektor.org.ua%2Fserver%2Fapi%2Flogin"></script>
</body>
</html>